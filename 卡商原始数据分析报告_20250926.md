# 卡商原始数据分析报告
**分析日期**: 2025年9月26日  
**数据来源**: 卡商API `/openapi/v1/card/auth_list`

## 1. API响应概况

### 请求参数
```json
{
  "date_start": "2025-09-26",
  "date_end": "2025-09-26", 
  "page": 1
}
```

### 响应结构
```json
{
  "page": 1,
  "page_size": 100,
  "total_count": 3,
  "key_list": [21个字段],
  "auth_list": [3条交易记录]
}
```

## 2. 字段映射分析

### 实际API返回的字段 (21个)
1. `card_id` - 卡片ID
2. `txn_id` - 交易ID  
3. `txn_type` - 交易类型 (A=授权, D=授权撤销)
4. `txn_status` - 交易状态 (0=失败, 1=成功)
5. `txn_time` - 交易时间
6. `txn_amt` - 交易金额
7. `txn_ccy` - 交易币种
8. `bill_amt` - 账单金额
9. `bill_ccy` - 账单币种
10. `mcc` - 商户类别码
11. `merch_name` - 商户名称
12. `merch_ctry` - 商户国家
13. `origin_txn_id` - 原始交易ID
14. `decline_reason` - 拒绝原因
15. `auth_code` - 授权码 ✨**新增字段**
16. `sub_id` - 子账户ID ✨**新增字段**
17. `force_post` - 强制过账标志 ✨**新增字段**
18. `pre_auth` - 预授权标志 ✨**新增字段**
19. `biz_type` - 业务类型 ✨**新增字段**
20. `remark` - 备注 ✨**新增字段**
21. `wallet_id` - 钱包ID ✨**新增字段**

### 代码原有预期字段 (14个)
❌ **字段数量不匹配**: 代码预期14个字段，实际API返回21个字段

## 3. 交易数据详细分析

### 交易1: 成功的UBER授权
```json
{
  "card_id": "358714de20250924223047",
  "txn_id": "A1971309563581976578",
  "txn_type": "A",
  "txn_status": "1",
  "txn_time": "2025-09-26 04:23:19.778",
  "txn_amt": "9.0000",
  "txn_ccy": "HKD",
  "bill_amt": "1.1900",
  "bill_ccy": "USD",
  "mcc": "4121 Taxicabs/Limousines",
  "merch_name": "UBER SHOPPER STATEMENT help.uber.com NLD",
  "merch_ctry": "NLD",
  "origin_txn_id": "0",
  "decline_reason": "",
  "auth_code": "963651",
  "sub_id": null,
  "force_post": false,
  "pre_auth": true,
  "biz_type": "99",
  "remark": "",
  "wallet_id": null
}
```
**特点**: 
- ✅ 授权成功
- 💰 金额: HKD 9.00 → USD 1.19
- 🚗 UBER出行服务
- 🔑 授权码: 963651
- ⏰ 预授权交易

### 交易2: 授权撤销
```json
{
  "card_id": "358714de20250924223047",
  "txn_id": "A1971309601313935362",
  "txn_type": "D",
  "txn_status": "1", 
  "txn_time": "2025-09-26 04:23:28.79",
  "txn_amt": "-9.0000",
  "txn_ccy": "HKD",
  "bill_amt": "-1.1900", 
  "bill_ccy": "USD",
  "mcc": "4121 Taxicabs/Limousines",
  "merch_name": "UBER SHOPPER STATEMENT help.uber.com NLD",
  "merch_ctry": "NLD",
  "origin_txn_id": "A1971309563581976578",
  "decline_reason": "",
  "auth_code": "963651",
  "sub_id": null,
  "force_post": false,
  "pre_auth": false,
  "biz_type": "99", 
  "remark": "",
  "wallet_id": null
}
```
**特点**:
- ❌ 授权撤销 (txn_type=D)
- 💰 负金额: HKD -9.00 → USD -1.19
- 🔗 关联原交易: A1971309563581976578
- ⏱️ 9秒后撤销

### 交易3: 失败的授权
```json
{
  "card_id": "358714de20250924223047",
  "txn_id": "A1971309613078941699",
  "txn_type": "A",
  "txn_status": "0",
  "txn_time": "2025-09-26 04:23:31.579", 
  "txn_amt": "9.0000",
  "txn_ccy": "HKD",
  "bill_amt": "1.1900",
  "bill_ccy": "USD",
  "mcc": "4121 Taxicabs/Limousines",
  "merch_name": "UBER SHOPPER STATEMENT help.uber.com NLD",
  "merch_ctry": "NLD",
  "origin_txn_id": "0",
  "decline_reason": "CVV2 Code Mismatch",
  "auth_code": "",
  "sub_id": null,
  "force_post": false,
  "pre_auth": false,
  "biz_type": "99",
  "remark": "",
  "wallet_id": null
}
```
**特点**:
- ❌ 授权失败 (txn_status=0)
- 🚫 拒绝原因: CVV2 Code Mismatch
- 🔓 无授权码
- ⏱️ 再次尝试但失败

## 4. 交易时序分析

```
04:23:19.778 → 授权成功 (A1971309563581976578) ✅
04:23:28.790 → 授权撤销 (A1971309601313935362) ❌ 
04:23:31.579 → 重新授权失败 (A1971309613078941699) ❌
```

**时间间隔**:
- 成功授权 → 撤销: 9秒
- 撤销 → 重试失败: 3秒

## 5. 新字段价值分析

### 高价值字段
- `auth_code`: 授权码，用于交易追踪和对账
- `pre_auth`: 预授权标志，区分预授权和普通授权
- `biz_type`: 业务类型，细分交易场景

### 中等价值字段  
- `force_post`: 强制过账标志
- `sub_id`: 子账户管理
- `wallet_id`: 钱包系统集成

### 低价值字段
- `remark`: 备注字段，目前为空

## 6. 问题与建议

### 已解决问题 ✅
1. **字段映射错误**: 已更新TypeScript类型定义从14字段到21字段
2. **数据解析错误**: 已修复syncService.ts中的字段解析逻辑
3. **新字段缺失**: 已在数据库插入逻辑中添加新字段处理

### 技术改进建议 💡
1. **动态字段映射**: 使用key_list动态映射字段，而非硬编码
2. **数据验证**: 增加字段值范围和格式验证
3. **日志优化**: 保留关键原始数据日志用于问题排查

### 业务洞察 📊
1. **CVV验证失败**: 用户可能需要卡片信息确认提醒
2. **预授权机制**: UBER使用预授权后撤销的模式
3. **多币种处理**: HKD→USD汇率约1:0.132

## 7. 同步状态总结

- **API调用**: ✅ 成功
- **数据获取**: ✅ 3条记录
- **字段解析**: ✅ 21字段完整解析  
- **数据插入**: ⏸️ 记录已存在，跳过插入
- **错误处理**: ✅ 0个错误

---
**报告生成时间**: 2025-09-26 18:45:21 UTC+8

