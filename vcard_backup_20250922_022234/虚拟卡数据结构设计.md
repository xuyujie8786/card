# è™šæ‹Ÿå¡æ•°æ®ç»“æ„è®¾è®¡

## æ•°æ®åº“è¡¨ç»“æ„

### ç”¨æˆ·è¡¨ (users) - è¯¦ç»†è®¾è®¡

```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL COMMENT 'ç”¨æˆ·å',
    email VARCHAR(100) UNIQUE NOT NULL COMMENT 'é‚®ç®±',
    password_hash VARCHAR(255) NOT NULL COMMENT 'å¯†ç å“ˆå¸Œ',
    name VARCHAR(100) COMMENT 'çœŸå®å§“å',
    role VARCHAR(20) DEFAULT 'user' COMMENT 'ç”¨æˆ·è§’è‰²: super_admin, admin, user',
    parent_id INTEGER REFERENCES users(id) COMMENT 'ä¸Šçº§ç”¨æˆ·IDï¼ˆç”¨äºadmin-userå…³ç³»ï¼‰',
    status VARCHAR(20) DEFAULT 'active' COMMENT 'ç”¨æˆ·çŠ¶æ€: active, inactive, suspended',
    
    -- é‡‘é¢ç›¸å…³å­—æ®µ (æ–°å¢éœ€æ±‚)
    balance DECIMAL(15,2) DEFAULT 0.00 COMMENT 'è´¦æˆ·ä½™é¢',
    credit_limit DECIMAL(15,2) DEFAULT 0.00 COMMENT 'ä¿¡ç”¨é¢åº¦',
    currency VARCHAR(3) DEFAULT 'USD' COMMENT 'é»˜è®¤å¸ç§',
    
    -- æ—¶é—´å­—æ®µ
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_username (username),
    INDEX idx_email (email),
    INDEX idx_parent_id (parent_id),
    INDEX idx_role (role),
    INDEX idx_status (status)
);
```

### ç”¨æˆ·èµ„é‡‘è®°å½•è¡¨ (user_balance_logs) - æ–°å¢è¡¨

```sql
CREATE TABLE user_balance_logs (
    id SERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL REFERENCES users(id),
    type VARCHAR(20) NOT NULL COMMENT 'æ“ä½œç±»å‹: deposit, withdraw, transfer_in, transfer_out, card_charge, refund',
    amount DECIMAL(15,2) NOT NULL COMMENT 'å˜åŠ¨é‡‘é¢',
    balance_before DECIMAL(15,2) NOT NULL COMMENT 'å˜åŠ¨å‰ä½™é¢',
    balance_after DECIMAL(15,2) NOT NULL COMMENT 'å˜åŠ¨åä½™é¢',
    currency VARCHAR(3) NOT NULL COMMENT 'å¸ç§',
    
    -- å…³è”ä¿¡æ¯
    related_card_id INTEGER COMMENT 'å…³è”çš„è™šæ‹Ÿå¡IDï¼ˆå¦‚æœæ˜¯å¼€å¡æ‰£è´¹ï¼‰',
    related_user_id INTEGER REFERENCES users(id) COMMENT 'å…³è”ç”¨æˆ·IDï¼ˆå¦‚æœæ˜¯è½¬è´¦ï¼‰',
    
    -- æè¿°ä¿¡æ¯
    description TEXT COMMENT 'æ“ä½œæè¿°',
    remark TEXT COMMENT 'å¤‡æ³¨',
    
    -- æ“ä½œè€…ä¿¡æ¯
    operated_by INTEGER NOT NULL REFERENCES users(id) COMMENT 'æ“ä½œè€…ç”¨æˆ·ID',
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_user_id (user_id),
    INDEX idx_type (type),
    INDEX idx_operated_by (operated_by),
    INDEX idx_created_at (created_at)
);
```

### è™šæ‹Ÿå¡è¡¨ (virtual_cards) - è¯¦ç»†è®¾è®¡

```sql
CREATE TABLE virtual_cards (
    id SERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL REFERENCES users(id),
    card_id VARCHAR(50) UNIQUE NOT NULL COMMENT 'å¡å•†è¿”å›çš„å¡ç‰‡ID',
    card_no VARCHAR(20) NOT NULL COMMENT 'å¡å·',
    cvv VARCHAR(4) NOT NULL COMMENT 'CVVç ',
    exp_date DATE NOT NULL COMMENT 'è¿‡æœŸæ—¶é—´',
    balance DECIMAL(10,2) DEFAULT 0.00 COMMENT 'ä½™é¢',
    currency VARCHAR(3) DEFAULT 'USD' COMMENT 'å¸ç§',
    status VARCHAR(20) DEFAULT 'active' COMMENT 'å¡ç‰‡çŠ¶æ€: active, frozen, released',
    
    -- å¼€å¡äººä¿¡æ¯ (æ–°å¢éœ€æ±‚)
    cardholder_name VARCHAR(100) NOT NULL COMMENT 'å¼€å¡äººå§“å',
    cardholder_username VARCHAR(50) NOT NULL COMMENT 'å¼€å¡äººç”¨æˆ·å',
    cardholder_email VARCHAR(100) COMMENT 'å¼€å¡äººé‚®ç®±',
    
    -- æ“ä½œè®°å½•
    created_by INTEGER NOT NULL REFERENCES users(id) COMMENT 'åˆ›å»ºè€…ç”¨æˆ·ID',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    -- å…¶ä»–ä¿¡æ¯
    remark TEXT COMMENT 'å¤‡æ³¨',
    
    INDEX idx_user_id (user_id),
    INDEX idx_card_id (card_id),
    INDEX idx_cardholder_username (cardholder_username),
    INDEX idx_status (status),
    INDEX idx_created_by (created_by)
);
```

## API å“åº”ç»“æ„

### ç”¨æˆ·åˆ—è¡¨ API å“åº”

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "username": "user001",
        "email": "user001@example.com",
        "name": "å¼ ä¸‰",
        "role": "user",
        "roleText": "æ™®é€šç”¨æˆ·",
        "status": "active",
        "statusText": "æ­£å¸¸",
        
        // é‡‘é¢ä¿¡æ¯ (æ–°å¢)
        "balance": 5000.00,
        "creditLimit": 10000.00,
        "currency": "USD",
        "availableAmount": 15000.00,
        
        // ä¸Šçº§ç”¨æˆ·ä¿¡æ¯
        "parent": {
          "id": 2,
          "username": "admin001",
          "name": "ç®¡ç†å‘˜A"
        },
        
        // ç»Ÿè®¡ä¿¡æ¯
        "cardCount": 5,
        "totalSpent": 2500.00,
        
        // æ—¶é—´ä¿¡æ¯
        "createdAt": "2024-01-15T10:30:00Z",
        "updatedAt": "2024-01-15T10:30:00Z"
      }
    ],
    "pagination": {
      "current": 1,
      "pageSize": 20,
      "total": 100
    }
  }
}
```

### ç”¨æˆ·èµ„é‡‘è®°å½• API å“åº”

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "type": "deposit",
        "typeText": "å……å€¼",
        "amount": 1000.00,
        "balanceBefore": 4000.00,
        "balanceAfter": 5000.00,
        "currency": "USD",
        "description": "ç®¡ç†å‘˜å……å€¼",
        "remark": "æµ‹è¯•å……å€¼",
        
        // æ“ä½œè€…ä¿¡æ¯
        "operatedBy": {
          "id": 2,
          "username": "admin001",
          "name": "ç®¡ç†å‘˜A"
        },
        
        // å…³è”ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
        "relatedCard": {
          "id": 10,
          "cardNo": "4***********1234"
        },
        
        "createdAt": "2024-01-15T10:30:00Z"
      }
    ],
    "pagination": {
      "current": 1,
      "pageSize": 20,
      "total": 50
    }
  }
}
```

### è™šæ‹Ÿå¡åˆ—è¡¨ API å“åº”

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "cardId": "CARD_123456789",
        "cardNo": "4***********1234",
        "balance": 1000.50,
        "currency": "USD",
        "status": "active",
        "statusText": "æ­£å¸¸",
        "expDate": "2026-12-31",
        
        // å¼€å¡äººä¿¡æ¯
        "cardholderName": "å¼ ä¸‰",
        "cardholderUsername": "zhangsan001",
        "cardholderEmail": "zhangsan@example.com",
        
        // åˆ›å»ºè€…ä¿¡æ¯
        "createdBy": {
          "id": 2,
          "username": "admin001",
          "name": "ç®¡ç†å‘˜A"
        },
        
        // æ—¶é—´ä¿¡æ¯
        "createdAt": "2024-01-15T10:30:00Z",
        "updatedAt": "2024-01-15T10:30:00Z",
        
        "remark": "æµ‹è¯•å¡ç‰‡"
      }
    ],
    "pagination": {
      "current": 1,
      "pageSize": 20,
      "total": 100
    }
  }
}
```

## å‰ç«¯é¡µé¢è®¾è®¡

### ç”¨æˆ·åˆ—è¡¨é¡µé¢ (UserList.tsx)

#### è¡¨æ ¼åˆ—å®šä¹‰
```typescript
const columns: ProColumns<User>[] = [
  {
    title: 'ç”¨æˆ·å',
    dataIndex: 'username',
    width: 120,
    render: (text) => <Tag color="blue">{text}</Tag>,
  },
  {
    title: 'å§“å',
    dataIndex: 'name',
    width: 100,
  },
  {
    title: 'é‚®ç®±',
    dataIndex: 'email',
    width: 180,
    copyable: true,
  },
  {
    title: 'è§’è‰²',
    dataIndex: 'role',
    width: 100,
    valueEnum: {
      super_admin: { text: 'è¶…çº§ç®¡ç†å‘˜', status: 'Error' },
      admin: { text: 'ç®¡ç†å‘˜', status: 'Warning' },
      user: { text: 'æ™®é€šç”¨æˆ·', status: 'Default' },
    },
  },
  {
    title: 'è´¦æˆ·ä½™é¢',
    dataIndex: 'balance',
    width: 120,
    render: (text, record) => (
      <span style={{ color: text > 0 ? '#52c41a' : '#ff4d4f' }}>
        {record.currency} {text.toLocaleString()}
      </span>
    ),
    sorter: true,
  },
  {
    title: 'ä¿¡ç”¨é¢åº¦',
    dataIndex: 'creditLimit',
    width: 120,
    render: (text, record) => `${record.currency} ${text.toLocaleString()}`,
  },
  {
    title: 'å¯ç”¨é‡‘é¢',
    dataIndex: 'availableAmount',
    width: 120,
    render: (text, record) => (
      <span style={{ fontWeight: 'bold', color: '#1890ff' }}>
        {record.currency} {text.toLocaleString()}
      </span>
    ),
  },
  {
    title: 'å¡ç‰‡æ•°é‡',
    dataIndex: 'cardCount',
    width: 80,
    render: (text) => <Badge count={text} showZero color="#108ee9" />,
  },
  {
    title: 'çŠ¶æ€',
    dataIndex: 'status',
    width: 80,
    valueEnum: {
      active: { text: 'æ­£å¸¸', status: 'Success' },
      inactive: { text: 'åœç”¨', status: 'Default' },
      suspended: { text: 'æš‚åœ', status: 'Warning' },
    },
  },
  {
    title: 'ä¸Šçº§ç”¨æˆ·',
    dataIndex: ['parent', 'username'],
    width: 100,
    render: (text) => text ? <Tag>{text}</Tag> : '-',
  },
  {
    title: 'åˆ›å»ºæ—¶é—´',
    dataIndex: 'createdAt',
    width: 150,
    valueType: 'dateTime',
    sorter: true,
  },
  {
    title: 'æ“ä½œ',
    valueType: 'option',
    width: 200,
    render: (_, record) => [
      <Button key="detail" type="link" size="small">
        è¯¦æƒ…
      </Button>,
      <Button key="recharge" type="link" size="small">
        å……å€¼
      </Button>,
      <Button key="withdraw" type="link" size="small">
        æç°
      </Button>,
      <Dropdown
        key="more"
        menu={{
          items: [
            { key: 'edit', label: 'ç¼–è¾‘' },
            { key: 'balance-log', label: 'èµ„é‡‘è®°å½•' },
            { key: 'reset-password', label: 'é‡ç½®å¯†ç ' },
            { key: 'suspend', label: record.status === 'active' ? 'æš‚åœ' : 'æ¿€æ´»' },
          ],
        }}
      >
        <Button type="link" size="small">
          æ›´å¤š <DownOutlined />
        </Button>
      </Dropdown>,
    ],
  },
];
```

#### ç”¨æˆ·æœç´¢è¡¨å•
```typescript
const searchForm = (
  <ProForm
    layout="inline"
    submitter={{
      render: (props, doms) => {
        return [
          <Button key="search" type="primary" onClick={() => props.form?.submit?.()}>
            æœç´¢
          </Button>,
          <Button key="reset" onClick={() => props.form?.resetFields?.()}>
            é‡ç½®
          </Button>,
        ];
      },
    }}
  >
    <ProFormText
      name="username"
      label="ç”¨æˆ·å"
      placeholder="è¯·è¾“å…¥ç”¨æˆ·å"
    />
    <ProFormText
      name="email"
      label="é‚®ç®±"
      placeholder="è¯·è¾“å…¥é‚®ç®±"
    />
    <ProFormSelect
      name="role"
      label="è§’è‰²"
      valueEnum={{
        super_admin: 'è¶…çº§ç®¡ç†å‘˜',
        admin: 'ç®¡ç†å‘˜',
        user: 'æ™®é€šç”¨æˆ·',
      }}
      placeholder="è¯·é€‰æ‹©è§’è‰²"
    />
    <ProFormSelect
      name="status"
      label="çŠ¶æ€"
      valueEnum={{
        active: 'æ­£å¸¸',
        inactive: 'åœç”¨',
        suspended: 'æš‚åœ',
      }}
      placeholder="è¯·é€‰æ‹©çŠ¶æ€"
    />
    <ProFormDateRangePicker
      name="dateRange"
      label="åˆ›å»ºæ—¶é—´"
    />
  </ProForm>
);
```

### ç”¨æˆ·åˆ›å»º/ç¼–è¾‘è¡¨å• (UserForm.tsx)

```typescript
const UserForm: React.FC<{ isEdit?: boolean; initialValues?: User }> = ({ 
  isEdit = false, 
  initialValues 
}) => {
  return (
    <ProForm
      initialValues={initialValues}
      onFinish={async (values) => {
        // æäº¤ç”¨æˆ·æ•°æ®
        console.log('ç”¨æˆ·æ•°æ®:', values);
      }}
    >
      <ProFormGroup title="åŸºæœ¬ä¿¡æ¯">
        <ProFormText
          name="username"
          label="ç”¨æˆ·å"
          rules={[{ required: true, message: 'è¯·è¾“å…¥ç”¨æˆ·å' }]}
          placeholder="è¯·è¾“å…¥ç”¨æˆ·å"
          width="md"
          disabled={isEdit}
        />
        <ProFormText
          name="name"
          label="çœŸå®å§“å"
          rules={[{ required: true, message: 'è¯·è¾“å…¥çœŸå®å§“å' }]}
          placeholder="è¯·è¾“å…¥çœŸå®å§“å"
          width="md"
        />
        <ProFormText
          name="email"
          label="é‚®ç®±"
          rules={[
            { required: true, message: 'è¯·è¾“å…¥é‚®ç®±' },
            { type: 'email', message: 'è¯·è¾“å…¥æ­£ç¡®çš„é‚®ç®±æ ¼å¼' }
          ]}
          placeholder="è¯·è¾“å…¥é‚®ç®±"
          width="md"
        />
      </ProFormGroup>
      
      <ProFormGroup title="æƒé™è®¾ç½®">
        <ProFormSelect
          name="role"
          label="ç”¨æˆ·è§’è‰²"
          options={[
            { label: 'æ™®é€šç”¨æˆ·', value: 'user' },
            { label: 'ç®¡ç†å‘˜', value: 'admin' },
            { label: 'è¶…çº§ç®¡ç†å‘˜', value: 'super_admin' },
          ]}
          rules={[{ required: true, message: 'è¯·é€‰æ‹©ç”¨æˆ·è§’è‰²' }]}
          width="md"
        />
        <ProFormSelect
          name="parentId"
          label="ä¸Šçº§ç”¨æˆ·"
          request={async () => {
            // è·å–å¯é€‰çš„ä¸Šçº§ç”¨æˆ·åˆ—è¡¨
            return [];
          }}
          placeholder="è¯·é€‰æ‹©ä¸Šçº§ç”¨æˆ·ï¼ˆå¯é€‰ï¼‰"
          width="md"
        />
        <ProFormSelect
          name="status"
          label="ç”¨æˆ·çŠ¶æ€"
          options={[
            { label: 'æ­£å¸¸', value: 'active' },
            { label: 'åœç”¨', value: 'inactive' },
            { label: 'æš‚åœ', value: 'suspended' },
          ]}
          rules={[{ required: true, message: 'è¯·é€‰æ‹©ç”¨æˆ·çŠ¶æ€' }]}
          width="md"
        />
      </ProFormGroup>
      
      <ProFormGroup title="èµ„é‡‘è®¾ç½®">
        <ProFormMoney
          name="balance"
          label="åˆå§‹ä½™é¢"
          min={0}
          max={1000000}
          rules={[{ required: true, message: 'è¯·è¾“å…¥åˆå§‹ä½™é¢' }]}
          width="md"
          addonBefore={
            <ProFormSelect
              name="currency"
              noStyle
              options={[
                { label: 'USD', value: 'USD' },
                { label: 'EUR', value: 'EUR' },
                { label: 'GBP', value: 'GBP' },
              ]}
            />
          }
        />
        <ProFormMoney
          name="creditLimit"
          label="ä¿¡ç”¨é¢åº¦"
          min={0}
          max={1000000}
          rules={[{ required: true, message: 'è¯·è¾“å…¥ä¿¡ç”¨é¢åº¦' }]}
          width="md"
          tooltip="ç”¨æˆ·å¯é€æ”¯çš„æœ€å¤§é‡‘é¢"
        />
      </ProFormGroup>
      
      {!isEdit && (
        <ProFormGroup title="å¯†ç è®¾ç½®">
          <ProFormText.Password
            name="password"
            label="ç™»å½•å¯†ç "
            rules={[
              { required: true, message: 'è¯·è¾“å…¥ç™»å½•å¯†ç ' },
              { min: 6, message: 'å¯†ç è‡³å°‘6ä½' }
            ]}
            placeholder="è¯·è¾“å…¥ç™»å½•å¯†ç "
            width="md"
          />
          <ProFormText.Password
            name="confirmPassword"
            label="ç¡®è®¤å¯†ç "
            dependencies={['password']}
            rules={[
              { required: true, message: 'è¯·ç¡®è®¤å¯†ç ' },
              ({ getFieldValue }) => ({
                validator(_, value) {
                  if (!value || getFieldValue('password') === value) {
                    return Promise.resolve();
                  }
                  return Promise.reject(new Error('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´'));
                },
              }),
            ]}
            placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç "
            width="md"
          />
        </ProFormGroup>
      )}
    </ProForm>
  );
};
```

### ç”¨æˆ·èµ„é‡‘æ“ä½œè¡¨å• (UserBalanceForm.tsx)

```typescript
const UserBalanceForm: React.FC<{ 
  type: 'deposit' | 'withdraw'; 
  user: User;
  onSuccess?: () => void;
}> = ({ type, user, onSuccess }) => {
  return (
    <ProForm
      onFinish={async (values) => {
        // æäº¤èµ„é‡‘æ“ä½œ
        console.log('èµ„é‡‘æ“ä½œ:', { type, userId: user.id, ...values });
        onSuccess?.();
      }}
    >
      <ProFormGroup title="ç”¨æˆ·ä¿¡æ¯">
        <ProFormText
          name="username"
          label="ç”¨æˆ·å"
          initialValue={user.username}
          readonly
          width="md"
        />
        <ProFormText
          name="currentBalance"
          label="å½“å‰ä½™é¢"
          initialValue={`${user.currency} ${user.balance.toLocaleString()}`}
          readonly
          width="md"
        />
        <ProFormText
          name="creditLimit"
          label="ä¿¡ç”¨é¢åº¦"
          initialValue={`${user.currency} ${user.creditLimit.toLocaleString()}`}
          readonly
          width="md"
        />
      </ProFormGroup>
      
      <ProFormGroup title={type === 'deposit' ? 'å……å€¼ä¿¡æ¯' : 'æç°ä¿¡æ¯'}>
        <ProFormMoney
          name="amount"
          label={type === 'deposit' ? 'å……å€¼é‡‘é¢' : 'æç°é‡‘é¢'}
          min={0.01}
          max={type === 'withdraw' ? user.availableAmount : 100000}
          rules={[{ required: true, message: `è¯·è¾“å…¥${type === 'deposit' ? 'å……å€¼' : 'æç°'}é‡‘é¢` }]}
          width="md"
          addonBefore={user.currency}
        />
        <ProFormTextArea
          name="remark"
          label="å¤‡æ³¨"
          placeholder={`è¯·è¾“å…¥${type === 'deposit' ? 'å……å€¼' : 'æç°'}å¤‡æ³¨`}
          width="xl"
        />
      </ProFormGroup>
      
      {type === 'withdraw' && (
        <Alert
          message="æç°æé†’"
          description={`ç”¨æˆ·å¯æç°é‡‘é¢ï¼š${user.currency} ${user.availableAmount.toLocaleString()}`}
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
    </ProForm>
  );
};
```

### è™šæ‹Ÿå¡åˆ—è¡¨é¡µé¢ (CardList.tsx)

#### è¡¨æ ¼åˆ—å®šä¹‰
```typescript
const columns: ProColumns<VirtualCard>[] = [
  {
    title: 'å¡å·',
    dataIndex: 'cardNo',
    width: 180,
    copyable: true,
  },
  {
    title: 'å¼€å¡äººç”¨æˆ·å',
    dataIndex: 'cardholderUsername',
    width: 120,
    render: (text) => <Tag color="blue">{text}</Tag>,
  },
  {
    title: 'å¼€å¡äººå§“å',
    dataIndex: 'cardholderName',
    width: 100,
  },
  {
    title: 'ä½™é¢',
    dataIndex: 'balance',
    width: 100,
    render: (text, record) => `${record.currency} ${text}`,
    sorter: true,
  },
  {
    title: 'çŠ¶æ€',
    dataIndex: 'status',
    width: 80,
    valueEnum: {
      active: { text: 'æ­£å¸¸', status: 'Success' },
      frozen: { text: 'å†»ç»“', status: 'Warning' },
      released: { text: 'å·²é‡Šæ”¾', status: 'Default' },
    },
  },
  {
    title: 'åˆ›å»ºè€…',
    dataIndex: ['createdBy', 'username'],
    width: 100,
  },
  {
    title: 'åˆ›å»ºæ—¶é—´',
    dataIndex: 'createdAt',
    width: 150,
    valueType: 'dateTime',
    sorter: true,
  },
  {
    title: 'æ“ä½œ',
    valueType: 'option',
    width: 200,
    render: (_, record) => [
      <Button key="detail" type="link" size="small">
        è¯¦æƒ…
      </Button>,
      <Button key="recharge" type="link" size="small">
        å……å€¼
      </Button>,
      <Button key="withdraw" type="link" size="small">
        æç°
      </Button>,
      <Dropdown
        key="more"
        menu={{
          items: [
            { key: 'freeze', label: 'å†»ç»“' },
            { key: 'activate', label: 'æ¿€æ´»' },
            { key: 'release', label: 'é‡Šæ”¾' },
          ],
        }}
      >
        <Button type="link" size="small">
          æ›´å¤š <DownOutlined />
        </Button>
      </Dropdown>,
    ],
  },
];
```

#### æœç´¢è¡¨å•
```typescript
const searchForm = (
  <ProForm
    layout="inline"
    submitter={{
      render: (props, doms) => {
        return [
          <Button key="search" type="primary" onClick={() => props.form?.submit?.()}>
            æœç´¢
          </Button>,
          <Button key="reset" onClick={() => props.form?.resetFields?.()}>
            é‡ç½®
          </Button>,
        ];
      },
    }}
  >
    <ProFormText
      name="cardholderUsername"
      label="å¼€å¡äººç”¨æˆ·å"
      placeholder="è¯·è¾“å…¥å¼€å¡äººç”¨æˆ·å"
    />
    <ProFormText
      name="cardNo"
      label="å¡å·"
      placeholder="è¯·è¾“å…¥å¡å·"
    />
    <ProFormSelect
      name="status"
      label="çŠ¶æ€"
      valueEnum={{
        active: 'æ­£å¸¸',
        frozen: 'å†»ç»“',
        released: 'å·²é‡Šæ”¾',
      }}
      placeholder="è¯·é€‰æ‹©çŠ¶æ€"
    />
    <ProFormDateRangePicker
      name="dateRange"
      label="åˆ›å»ºæ—¶é—´"
    />
  </ProForm>
);
```

### å¼€å¡è¡¨å•é¡µé¢ (CreateCard.tsx)

```typescript
const CreateCardForm: React.FC = () => {
  return (
    <ProForm
      onFinish={async (values) => {
        // æäº¤å¼€å¡è¯·æ±‚
        console.log('å¼€å¡æ•°æ®:', values);
      }}
    >
      <ProFormGroup title="å¼€å¡äººä¿¡æ¯">
        <ProFormText
          name="cardholderUsername"
          label="å¼€å¡äººç”¨æˆ·å"
          rules={[{ required: true, message: 'è¯·è¾“å…¥å¼€å¡äººç”¨æˆ·å' }]}
          placeholder="è¯·è¾“å…¥å¼€å¡äººç”¨æˆ·å"
          width="md"
        />
        <ProFormText
          name="cardholderName"
          label="å¼€å¡äººå§“å"
          rules={[{ required: true, message: 'è¯·è¾“å…¥å¼€å¡äººå§“å' }]}
          placeholder="è¯·è¾“å…¥å¼€å¡äººå§“å"
          width="md"
        />
        <ProFormText
          name="cardholderEmail"
          label="å¼€å¡äººé‚®ç®±"
          rules={[
            { required: true, message: 'è¯·è¾“å…¥å¼€å¡äººé‚®ç®±' },
            { type: 'email', message: 'è¯·è¾“å…¥æ­£ç¡®çš„é‚®ç®±æ ¼å¼' }
          ]}
          placeholder="è¯·è¾“å…¥å¼€å¡äººé‚®ç®±"
          width="md"
        />
      </ProFormGroup>
      
      <ProFormGroup title="å¡ç‰‡ä¿¡æ¯">
        <ProFormSelect
          name="currency"
          label="å¸ç§"
          options={[
            { label: 'USD', value: 'USD' },
            { label: 'EUR', value: 'EUR' },
            { label: 'GBP', value: 'GBP' },
          ]}
          rules={[{ required: true, message: 'è¯·é€‰æ‹©å¸ç§' }]}
          width="sm"
        />
        <ProFormMoney
          name="initialAmount"
          label="åˆå§‹é‡‘é¢"
          min={0}
          max={10000}
          rules={[{ required: true, message: 'è¯·è¾“å…¥åˆå§‹é‡‘é¢' }]}
          width="md"
        />
        <ProFormTextArea
          name="remark"
          label="å¤‡æ³¨"
          placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯"
          width="xl"
        />
      </ProFormGroup>
    </ProForm>
  );
};
```

## æ•°æ®ç±»å‹å®šä¹‰

### TypeScript æ¥å£

```typescript
// ç”¨æˆ·æ¥å£ (æ–°å¢)
interface User {
  id: number;
  username: string;
  email: string;
  name: string;
  role: 'super_admin' | 'admin' | 'user';
  roleText: string;
  status: 'active' | 'inactive' | 'suspended';
  statusText: string;
  
  // é‡‘é¢ä¿¡æ¯ (æ–°å¢)
  balance: number;
  creditLimit: number;
  currency: string;
  availableAmount: number; // ä½™é¢ + ä¿¡ç”¨é¢åº¦
  
  // ä¸Šçº§ç”¨æˆ·ä¿¡æ¯
  parent?: {
    id: number;
    username: string;
    name: string;
  };
  
  // ç»Ÿè®¡ä¿¡æ¯
  cardCount: number;
  totalSpent: number;
  
  // æ—¶é—´ä¿¡æ¯
  createdAt: string;
  updatedAt: string;
}

// ç”¨æˆ·åˆ›å»ºè¯·æ±‚æ¥å£
interface CreateUserRequest {
  username: string;
  name: string;
  email: string;
  password: string;
  role: string;
  parentId?: number;
  status: string;
  balance: number;
  creditLimit: number;
  currency: string;
}

// ç”¨æˆ·ç¼–è¾‘è¯·æ±‚æ¥å£
interface UpdateUserRequest {
  name?: string;
  email?: string;
  role?: string;
  parentId?: number;
  status?: string;
  balance?: number;
  creditLimit?: number;
  currency?: string;
}

// ç”¨æˆ·èµ„é‡‘è®°å½•æ¥å£
interface UserBalanceLog {
  id: number;
  type: 'deposit' | 'withdraw' | 'transfer_in' | 'transfer_out' | 'card_charge' | 'refund';
  typeText: string;
  amount: number;
  balanceBefore: number;
  balanceAfter: number;
  currency: string;
  description: string;
  remark?: string;
  
  // æ“ä½œè€…ä¿¡æ¯
  operatedBy: {
    id: number;
    username: string;
    name: string;
  };
  
  // å…³è”ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
  relatedCard?: {
    id: number;
    cardNo: string;
  };
  relatedUser?: {
    id: number;
    username: string;
    name: string;
  };
  
  createdAt: string;
}

// èµ„é‡‘æ“ä½œè¯·æ±‚æ¥å£
interface BalanceOperationRequest {
  userId: number;
  type: 'deposit' | 'withdraw';
  amount: number;
  remark?: string;
}

// ç”¨æˆ·åˆ—è¡¨æŸ¥è¯¢å‚æ•°
interface UserListParams {
  current?: number;
  pageSize?: number;
  username?: string;
  email?: string;
  role?: string;
  status?: string;
  dateRange?: [string, string];
}

// è™šæ‹Ÿå¡æ¥å£
interface VirtualCard {
  id: number;
  cardId: string;
  cardNo: string;
  balance: number;
  currency: string;
  status: 'active' | 'frozen' | 'released';
  statusText: string;
  expDate: string;
  
  // å¼€å¡äººä¿¡æ¯
  cardholderName: string;
  cardholderUsername: string;
  cardholderEmail?: string;
  
  // åˆ›å»ºè€…ä¿¡æ¯
  createdBy: {
    id: number;
    username: string;
    name: string;
  };
  
  // æ—¶é—´ä¿¡æ¯
  createdAt: string;
  updatedAt: string;
  
  remark?: string;
}

// å¼€å¡è¯·æ±‚æ¥å£
interface CreateCardRequest {
  cardholderUsername: string;
  cardholderName: string;
  cardholderEmail: string;
  currency: string;
  initialAmount: number;
  remark?: string;
}

// å¡ç‰‡åˆ—è¡¨æŸ¥è¯¢å‚æ•°
interface CardListParams {
  current?: number;
  pageSize?: number;
  cardholderUsername?: string;
  cardNo?: string;
  status?: string;
  dateRange?: [string, string];
}
```

## åŠŸèƒ½ç‰¹æ€§

### 1. ç”¨æˆ·é‡‘é¢ç®¡ç† (æ–°å¢åŠŸèƒ½)
- âœ… ç”¨æˆ·è´¦æˆ·ä½™é¢ç®¡ç†
- âœ… ä¿¡ç”¨é¢åº¦è®¾ç½®
- âœ… å¤šå¸ç§æ”¯æŒ (USD, EUR, GBP)
- âœ… å¯ç”¨é‡‘é¢è®¡ç®— (ä½™é¢ + ä¿¡ç”¨é¢åº¦)
- âœ… å……å€¼åŠŸèƒ½ (ç®¡ç†å‘˜æ“ä½œ)
- âœ… æç°åŠŸèƒ½ (ç®¡ç†å‘˜æ“ä½œ)
- âœ… èµ„é‡‘è®°å½•è¿½è¸ª
- âœ… å¼€å¡è‡ªåŠ¨æ‰£è´¹

### 2. ç”¨æˆ·ç®¡ç†åŠŸèƒ½
- âœ… ç”¨æˆ·åˆ›å»ºæ—¶è®¾ç½®åˆå§‹ä½™é¢å’Œä¿¡ç”¨é¢åº¦
- âœ… ç”¨æˆ·åˆ—è¡¨æ˜¾ç¤ºé‡‘é¢ä¿¡æ¯
- âœ… æŒ‰ä½™é¢èŒƒå›´ç­›é€‰ç”¨æˆ·
- âœ… èµ„é‡‘æ“ä½œæƒé™æ§åˆ¶
- âœ… ç”¨æˆ·èµ„é‡‘è®°å½•æŸ¥è¯¢

### 3. å¼€å¡äººä¿¡æ¯ç®¡ç†
- âœ… å½•å…¥å¼€å¡äººç”¨æˆ·åï¼ˆå¿…å¡«ï¼‰
- âœ… å½•å…¥å¼€å¡äººå§“åï¼ˆå¿…å¡«ï¼‰  
- âœ… å½•å…¥å¼€å¡äººé‚®ç®±ï¼ˆå¯é€‰ï¼‰
- âœ… æ˜¾ç¤ºåœ¨å¡ç‰‡åˆ—è¡¨ä¸­

### 2. æœç´¢å’Œç­›é€‰
- âœ… æŒ‰å¼€å¡äººç”¨æˆ·åæœç´¢
- âœ… æŒ‰å¡å·æœç´¢
- âœ… æŒ‰å¡ç‰‡çŠ¶æ€ç­›é€‰
- âœ… æŒ‰åˆ›å»ºæ—¶é—´èŒƒå›´ç­›é€‰

### 3. åˆ—è¡¨å±•ç¤º
- âœ… è¡¨æ ¼å½¢å¼å±•ç¤ºæ‰€æœ‰å¡ç‰‡ä¿¡æ¯
- âœ… æ”¯æŒæ’åºï¼ˆä½™é¢ã€åˆ›å»ºæ—¶é—´ï¼‰
- âœ… æ”¯æŒåˆ†é¡µ
- âœ… æ˜¾ç¤ºåˆ›å»ºè€…ä¿¡æ¯

### 4. æƒé™æ§åˆ¶
- æ™®é€šç”¨æˆ·åªèƒ½çœ‹åˆ°è‡ªå·±åˆ›å»ºçš„å¡ç‰‡
- ç®¡ç†å‘˜å¯ä»¥çœ‹åˆ°ä¸‹å±ç”¨æˆ·åˆ›å»ºçš„å¡ç‰‡
- è¶…çº§ç®¡ç†å‘˜å¯ä»¥çœ‹åˆ°æ‰€æœ‰å¡ç‰‡

### 5. æ•°æ®å¯¼å‡º
- æ”¯æŒå¯¼å‡ºExcelæ ¼å¼
- åŒ…å«æ‰€æœ‰å¼€å¡äººä¿¡æ¯
- æ”¯æŒæŒ‰ç­›é€‰æ¡ä»¶å¯¼å‡º

## å®ç°ä¼˜å…ˆçº§

### é«˜ä¼˜å…ˆçº§ï¼ˆå¿…é¡»å®ç°ï¼‰
1. âœ… ç”¨æˆ·è¡¨ç»“æ„æ›´æ–°ï¼ˆæ·»åŠ é‡‘é¢å­—æ®µï¼‰
2. âœ… ç”¨æˆ·èµ„é‡‘è®°å½•è¡¨åˆ›å»º
3. âœ… ç”¨æˆ·åˆ›å»º/ç¼–è¾‘è¡¨å•æ·»åŠ é‡‘é¢è®¾ç½®
4. âœ… ç”¨æˆ·åˆ—è¡¨æ˜¾ç¤ºé‡‘é¢ä¿¡æ¯
5. âœ… ç”¨æˆ·å……å€¼/æç°åŠŸèƒ½
6. âœ… å¼€å¡è¡¨å•æ·»åŠ å¼€å¡äººä¿¡æ¯å­—æ®µ
7. âœ… å¡ç‰‡åˆ—è¡¨æ˜¾ç¤ºå¼€å¡äººç”¨æˆ·å
8. âœ… æŒ‰å¼€å¡äººç”¨æˆ·åæœç´¢åŠŸèƒ½

### ä¸­ä¼˜å…ˆçº§ï¼ˆé‡è¦åŠŸèƒ½ï¼‰
1. ğŸ”„ ç”¨æˆ·èµ„é‡‘è®°å½•æŸ¥è¯¢é¡µé¢
2. ğŸ”„ å¼€å¡è‡ªåŠ¨æ‰£è´¹é€»è¾‘
3. ğŸ”„ èµ„é‡‘æ“ä½œæƒé™æ§åˆ¶
4. ğŸ”„ å¤šå¸ç§æ±‡ç‡è½¬æ¢
5. ğŸ”„ å¡ç‰‡è¯¦æƒ…é¡µé¢æ˜¾ç¤ºå®Œæ•´å¼€å¡äººä¿¡æ¯
6. ğŸ”„ æ•°æ®å¯¼å‡ºåŠŸèƒ½

### ä½ä¼˜å…ˆçº§ï¼ˆå¢å¼ºåŠŸèƒ½ï¼‰
1. â³ ç”¨æˆ·é‡‘é¢ç»Ÿè®¡åˆ†æ
2. â³ èµ„é‡‘é¢„è­¦åŠŸèƒ½
3. â³ æ‰¹é‡èµ„é‡‘æ“ä½œ
4. â³ å¼€å¡äººä¿¡æ¯ç»Ÿè®¡åˆ†æ
5. â³ é«˜çº§ç­›é€‰åŠŸèƒ½
