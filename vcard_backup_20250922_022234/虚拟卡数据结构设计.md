# 虚拟卡数据结构设计

## 数据库表结构

### 用户表 (users) - 详细设计

```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL COMMENT '用户名',
    email VARCHAR(100) UNIQUE NOT NULL COMMENT '邮箱',
    password_hash VARCHAR(255) NOT NULL COMMENT '密码哈希',
    name VARCHAR(100) COMMENT '真实姓名',
    role VARCHAR(20) DEFAULT 'user' COMMENT '用户角色: super_admin, admin, user',
    parent_id INTEGER REFERENCES users(id) COMMENT '上级用户ID（用于admin-user关系）',
    status VARCHAR(20) DEFAULT 'active' COMMENT '用户状态: active, inactive, suspended',
    
    -- 金额相关字段 (新增需求)
    balance DECIMAL(15,2) DEFAULT 0.00 COMMENT '账户余额',
    credit_limit DECIMAL(15,2) DEFAULT 0.00 COMMENT '信用额度',
    currency VARCHAR(3) DEFAULT 'USD' COMMENT '默认币种',
    
    -- 时间字段
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_username (username),
    INDEX idx_email (email),
    INDEX idx_parent_id (parent_id),
    INDEX idx_role (role),
    INDEX idx_status (status)
);
```

### 用户资金记录表 (user_balance_logs) - 新增表

```sql
CREATE TABLE user_balance_logs (
    id SERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL REFERENCES users(id),
    type VARCHAR(20) NOT NULL COMMENT '操作类型: deposit, withdraw, transfer_in, transfer_out, card_charge, refund',
    amount DECIMAL(15,2) NOT NULL COMMENT '变动金额',
    balance_before DECIMAL(15,2) NOT NULL COMMENT '变动前余额',
    balance_after DECIMAL(15,2) NOT NULL COMMENT '变动后余额',
    currency VARCHAR(3) NOT NULL COMMENT '币种',
    
    -- 关联信息
    related_card_id INTEGER COMMENT '关联的虚拟卡ID（如果是开卡扣费）',
    related_user_id INTEGER REFERENCES users(id) COMMENT '关联用户ID（如果是转账）',
    
    -- 描述信息
    description TEXT COMMENT '操作描述',
    remark TEXT COMMENT '备注',
    
    -- 操作者信息
    operated_by INTEGER NOT NULL REFERENCES users(id) COMMENT '操作者用户ID',
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_user_id (user_id),
    INDEX idx_type (type),
    INDEX idx_operated_by (operated_by),
    INDEX idx_created_at (created_at)
);
```

### 虚拟卡表 (virtual_cards) - 详细设计

```sql
CREATE TABLE virtual_cards (
    id SERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL REFERENCES users(id),
    card_id VARCHAR(50) UNIQUE NOT NULL COMMENT '卡商返回的卡片ID',
    card_no VARCHAR(20) NOT NULL COMMENT '卡号',
    cvv VARCHAR(4) NOT NULL COMMENT 'CVV码',
    exp_date DATE NOT NULL COMMENT '过期时间',
    balance DECIMAL(10,2) DEFAULT 0.00 COMMENT '余额',
    currency VARCHAR(3) DEFAULT 'USD' COMMENT '币种',
    status VARCHAR(20) DEFAULT 'active' COMMENT '卡片状态: active, frozen, released',
    
    -- 开卡人信息 (新增需求)
    cardholder_name VARCHAR(100) NOT NULL COMMENT '开卡人姓名',
    cardholder_username VARCHAR(50) NOT NULL COMMENT '开卡人用户名',
    cardholder_email VARCHAR(100) COMMENT '开卡人邮箱',
    
    -- 操作记录
    created_by INTEGER NOT NULL REFERENCES users(id) COMMENT '创建者用户ID',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    -- 其他信息
    remark TEXT COMMENT '备注',
    
    INDEX idx_user_id (user_id),
    INDEX idx_card_id (card_id),
    INDEX idx_cardholder_username (cardholder_username),
    INDEX idx_status (status),
    INDEX idx_created_by (created_by)
);
```

## API 响应结构

### 用户列表 API 响应

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "username": "user001",
        "email": "user001@example.com",
        "name": "张三",
        "role": "user",
        "roleText": "普通用户",
        "status": "active",
        "statusText": "正常",
        
        // 金额信息 (新增)
        "balance": 5000.00,
        "creditLimit": 10000.00,
        "currency": "USD",
        "availableAmount": 15000.00,
        
        // 上级用户信息
        "parent": {
          "id": 2,
          "username": "admin001",
          "name": "管理员A"
        },
        
        // 统计信息
        "cardCount": 5,
        "totalSpent": 2500.00,
        
        // 时间信息
        "createdAt": "2024-01-15T10:30:00Z",
        "updatedAt": "2024-01-15T10:30:00Z"
      }
    ],
    "pagination": {
      "current": 1,
      "pageSize": 20,
      "total": 100
    }
  }
}
```

### 用户资金记录 API 响应

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "type": "deposit",
        "typeText": "充值",
        "amount": 1000.00,
        "balanceBefore": 4000.00,
        "balanceAfter": 5000.00,
        "currency": "USD",
        "description": "管理员充值",
        "remark": "测试充值",
        
        // 操作者信息
        "operatedBy": {
          "id": 2,
          "username": "admin001",
          "name": "管理员A"
        },
        
        // 关联信息（可选）
        "relatedCard": {
          "id": 10,
          "cardNo": "4***********1234"
        },
        
        "createdAt": "2024-01-15T10:30:00Z"
      }
    ],
    "pagination": {
      "current": 1,
      "pageSize": 20,
      "total": 50
    }
  }
}
```

### 虚拟卡列表 API 响应

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "cardId": "CARD_123456789",
        "cardNo": "4***********1234",
        "balance": 1000.50,
        "currency": "USD",
        "status": "active",
        "statusText": "正常",
        "expDate": "2026-12-31",
        
        // 开卡人信息
        "cardholderName": "张三",
        "cardholderUsername": "zhangsan001",
        "cardholderEmail": "zhangsan@example.com",
        
        // 创建者信息
        "createdBy": {
          "id": 2,
          "username": "admin001",
          "name": "管理员A"
        },
        
        // 时间信息
        "createdAt": "2024-01-15T10:30:00Z",
        "updatedAt": "2024-01-15T10:30:00Z",
        
        "remark": "测试卡片"
      }
    ],
    "pagination": {
      "current": 1,
      "pageSize": 20,
      "total": 100
    }
  }
}
```

## 前端页面设计

### 用户列表页面 (UserList.tsx)

#### 表格列定义
```typescript
const columns: ProColumns<User>[] = [
  {
    title: '用户名',
    dataIndex: 'username',
    width: 120,
    render: (text) => <Tag color="blue">{text}</Tag>,
  },
  {
    title: '姓名',
    dataIndex: 'name',
    width: 100,
  },
  {
    title: '邮箱',
    dataIndex: 'email',
    width: 180,
    copyable: true,
  },
  {
    title: '角色',
    dataIndex: 'role',
    width: 100,
    valueEnum: {
      super_admin: { text: '超级管理员', status: 'Error' },
      admin: { text: '管理员', status: 'Warning' },
      user: { text: '普通用户', status: 'Default' },
    },
  },
  {
    title: '账户余额',
    dataIndex: 'balance',
    width: 120,
    render: (text, record) => (
      <span style={{ color: text > 0 ? '#52c41a' : '#ff4d4f' }}>
        {record.currency} {text.toLocaleString()}
      </span>
    ),
    sorter: true,
  },
  {
    title: '信用额度',
    dataIndex: 'creditLimit',
    width: 120,
    render: (text, record) => `${record.currency} ${text.toLocaleString()}`,
  },
  {
    title: '可用金额',
    dataIndex: 'availableAmount',
    width: 120,
    render: (text, record) => (
      <span style={{ fontWeight: 'bold', color: '#1890ff' }}>
        {record.currency} {text.toLocaleString()}
      </span>
    ),
  },
  {
    title: '卡片数量',
    dataIndex: 'cardCount',
    width: 80,
    render: (text) => <Badge count={text} showZero color="#108ee9" />,
  },
  {
    title: '状态',
    dataIndex: 'status',
    width: 80,
    valueEnum: {
      active: { text: '正常', status: 'Success' },
      inactive: { text: '停用', status: 'Default' },
      suspended: { text: '暂停', status: 'Warning' },
    },
  },
  {
    title: '上级用户',
    dataIndex: ['parent', 'username'],
    width: 100,
    render: (text) => text ? <Tag>{text}</Tag> : '-',
  },
  {
    title: '创建时间',
    dataIndex: 'createdAt',
    width: 150,
    valueType: 'dateTime',
    sorter: true,
  },
  {
    title: '操作',
    valueType: 'option',
    width: 200,
    render: (_, record) => [
      <Button key="detail" type="link" size="small">
        详情
      </Button>,
      <Button key="recharge" type="link" size="small">
        充值
      </Button>,
      <Button key="withdraw" type="link" size="small">
        提现
      </Button>,
      <Dropdown
        key="more"
        menu={{
          items: [
            { key: 'edit', label: '编辑' },
            { key: 'balance-log', label: '资金记录' },
            { key: 'reset-password', label: '重置密码' },
            { key: 'suspend', label: record.status === 'active' ? '暂停' : '激活' },
          ],
        }}
      >
        <Button type="link" size="small">
          更多 <DownOutlined />
        </Button>
      </Dropdown>,
    ],
  },
];
```

#### 用户搜索表单
```typescript
const searchForm = (
  <ProForm
    layout="inline"
    submitter={{
      render: (props, doms) => {
        return [
          <Button key="search" type="primary" onClick={() => props.form?.submit?.()}>
            搜索
          </Button>,
          <Button key="reset" onClick={() => props.form?.resetFields?.()}>
            重置
          </Button>,
        ];
      },
    }}
  >
    <ProFormText
      name="username"
      label="用户名"
      placeholder="请输入用户名"
    />
    <ProFormText
      name="email"
      label="邮箱"
      placeholder="请输入邮箱"
    />
    <ProFormSelect
      name="role"
      label="角色"
      valueEnum={{
        super_admin: '超级管理员',
        admin: '管理员',
        user: '普通用户',
      }}
      placeholder="请选择角色"
    />
    <ProFormSelect
      name="status"
      label="状态"
      valueEnum={{
        active: '正常',
        inactive: '停用',
        suspended: '暂停',
      }}
      placeholder="请选择状态"
    />
    <ProFormDateRangePicker
      name="dateRange"
      label="创建时间"
    />
  </ProForm>
);
```

### 用户创建/编辑表单 (UserForm.tsx)

```typescript
const UserForm: React.FC<{ isEdit?: boolean; initialValues?: User }> = ({ 
  isEdit = false, 
  initialValues 
}) => {
  return (
    <ProForm
      initialValues={initialValues}
      onFinish={async (values) => {
        // 提交用户数据
        console.log('用户数据:', values);
      }}
    >
      <ProFormGroup title="基本信息">
        <ProFormText
          name="username"
          label="用户名"
          rules={[{ required: true, message: '请输入用户名' }]}
          placeholder="请输入用户名"
          width="md"
          disabled={isEdit}
        />
        <ProFormText
          name="name"
          label="真实姓名"
          rules={[{ required: true, message: '请输入真实姓名' }]}
          placeholder="请输入真实姓名"
          width="md"
        />
        <ProFormText
          name="email"
          label="邮箱"
          rules={[
            { required: true, message: '请输入邮箱' },
            { type: 'email', message: '请输入正确的邮箱格式' }
          ]}
          placeholder="请输入邮箱"
          width="md"
        />
      </ProFormGroup>
      
      <ProFormGroup title="权限设置">
        <ProFormSelect
          name="role"
          label="用户角色"
          options={[
            { label: '普通用户', value: 'user' },
            { label: '管理员', value: 'admin' },
            { label: '超级管理员', value: 'super_admin' },
          ]}
          rules={[{ required: true, message: '请选择用户角色' }]}
          width="md"
        />
        <ProFormSelect
          name="parentId"
          label="上级用户"
          request={async () => {
            // 获取可选的上级用户列表
            return [];
          }}
          placeholder="请选择上级用户（可选）"
          width="md"
        />
        <ProFormSelect
          name="status"
          label="用户状态"
          options={[
            { label: '正常', value: 'active' },
            { label: '停用', value: 'inactive' },
            { label: '暂停', value: 'suspended' },
          ]}
          rules={[{ required: true, message: '请选择用户状态' }]}
          width="md"
        />
      </ProFormGroup>
      
      <ProFormGroup title="资金设置">
        <ProFormMoney
          name="balance"
          label="初始余额"
          min={0}
          max={1000000}
          rules={[{ required: true, message: '请输入初始余额' }]}
          width="md"
          addonBefore={
            <ProFormSelect
              name="currency"
              noStyle
              options={[
                { label: 'USD', value: 'USD' },
                { label: 'EUR', value: 'EUR' },
                { label: 'GBP', value: 'GBP' },
              ]}
            />
          }
        />
        <ProFormMoney
          name="creditLimit"
          label="信用额度"
          min={0}
          max={1000000}
          rules={[{ required: true, message: '请输入信用额度' }]}
          width="md"
          tooltip="用户可透支的最大金额"
        />
      </ProFormGroup>
      
      {!isEdit && (
        <ProFormGroup title="密码设置">
          <ProFormText.Password
            name="password"
            label="登录密码"
            rules={[
              { required: true, message: '请输入登录密码' },
              { min: 6, message: '密码至少6位' }
            ]}
            placeholder="请输入登录密码"
            width="md"
          />
          <ProFormText.Password
            name="confirmPassword"
            label="确认密码"
            dependencies={['password']}
            rules={[
              { required: true, message: '请确认密码' },
              ({ getFieldValue }) => ({
                validator(_, value) {
                  if (!value || getFieldValue('password') === value) {
                    return Promise.resolve();
                  }
                  return Promise.reject(new Error('两次输入的密码不一致'));
                },
              }),
            ]}
            placeholder="请再次输入密码"
            width="md"
          />
        </ProFormGroup>
      )}
    </ProForm>
  );
};
```

### 用户资金操作表单 (UserBalanceForm.tsx)

```typescript
const UserBalanceForm: React.FC<{ 
  type: 'deposit' | 'withdraw'; 
  user: User;
  onSuccess?: () => void;
}> = ({ type, user, onSuccess }) => {
  return (
    <ProForm
      onFinish={async (values) => {
        // 提交资金操作
        console.log('资金操作:', { type, userId: user.id, ...values });
        onSuccess?.();
      }}
    >
      <ProFormGroup title="用户信息">
        <ProFormText
          name="username"
          label="用户名"
          initialValue={user.username}
          readonly
          width="md"
        />
        <ProFormText
          name="currentBalance"
          label="当前余额"
          initialValue={`${user.currency} ${user.balance.toLocaleString()}`}
          readonly
          width="md"
        />
        <ProFormText
          name="creditLimit"
          label="信用额度"
          initialValue={`${user.currency} ${user.creditLimit.toLocaleString()}`}
          readonly
          width="md"
        />
      </ProFormGroup>
      
      <ProFormGroup title={type === 'deposit' ? '充值信息' : '提现信息'}>
        <ProFormMoney
          name="amount"
          label={type === 'deposit' ? '充值金额' : '提现金额'}
          min={0.01}
          max={type === 'withdraw' ? user.availableAmount : 100000}
          rules={[{ required: true, message: `请输入${type === 'deposit' ? '充值' : '提现'}金额` }]}
          width="md"
          addonBefore={user.currency}
        />
        <ProFormTextArea
          name="remark"
          label="备注"
          placeholder={`请输入${type === 'deposit' ? '充值' : '提现'}备注`}
          width="xl"
        />
      </ProFormGroup>
      
      {type === 'withdraw' && (
        <Alert
          message="提现提醒"
          description={`用户可提现金额：${user.currency} ${user.availableAmount.toLocaleString()}`}
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
    </ProForm>
  );
};
```

### 虚拟卡列表页面 (CardList.tsx)

#### 表格列定义
```typescript
const columns: ProColumns<VirtualCard>[] = [
  {
    title: '卡号',
    dataIndex: 'cardNo',
    width: 180,
    copyable: true,
  },
  {
    title: '开卡人用户名',
    dataIndex: 'cardholderUsername',
    width: 120,
    render: (text) => <Tag color="blue">{text}</Tag>,
  },
  {
    title: '开卡人姓名',
    dataIndex: 'cardholderName',
    width: 100,
  },
  {
    title: '余额',
    dataIndex: 'balance',
    width: 100,
    render: (text, record) => `${record.currency} ${text}`,
    sorter: true,
  },
  {
    title: '状态',
    dataIndex: 'status',
    width: 80,
    valueEnum: {
      active: { text: '正常', status: 'Success' },
      frozen: { text: '冻结', status: 'Warning' },
      released: { text: '已释放', status: 'Default' },
    },
  },
  {
    title: '创建者',
    dataIndex: ['createdBy', 'username'],
    width: 100,
  },
  {
    title: '创建时间',
    dataIndex: 'createdAt',
    width: 150,
    valueType: 'dateTime',
    sorter: true,
  },
  {
    title: '操作',
    valueType: 'option',
    width: 200,
    render: (_, record) => [
      <Button key="detail" type="link" size="small">
        详情
      </Button>,
      <Button key="recharge" type="link" size="small">
        充值
      </Button>,
      <Button key="withdraw" type="link" size="small">
        提现
      </Button>,
      <Dropdown
        key="more"
        menu={{
          items: [
            { key: 'freeze', label: '冻结' },
            { key: 'activate', label: '激活' },
            { key: 'release', label: '释放' },
          ],
        }}
      >
        <Button type="link" size="small">
          更多 <DownOutlined />
        </Button>
      </Dropdown>,
    ],
  },
];
```

#### 搜索表单
```typescript
const searchForm = (
  <ProForm
    layout="inline"
    submitter={{
      render: (props, doms) => {
        return [
          <Button key="search" type="primary" onClick={() => props.form?.submit?.()}>
            搜索
          </Button>,
          <Button key="reset" onClick={() => props.form?.resetFields?.()}>
            重置
          </Button>,
        ];
      },
    }}
  >
    <ProFormText
      name="cardholderUsername"
      label="开卡人用户名"
      placeholder="请输入开卡人用户名"
    />
    <ProFormText
      name="cardNo"
      label="卡号"
      placeholder="请输入卡号"
    />
    <ProFormSelect
      name="status"
      label="状态"
      valueEnum={{
        active: '正常',
        frozen: '冻结',
        released: '已释放',
      }}
      placeholder="请选择状态"
    />
    <ProFormDateRangePicker
      name="dateRange"
      label="创建时间"
    />
  </ProForm>
);
```

### 开卡表单页面 (CreateCard.tsx)

```typescript
const CreateCardForm: React.FC = () => {
  return (
    <ProForm
      onFinish={async (values) => {
        // 提交开卡请求
        console.log('开卡数据:', values);
      }}
    >
      <ProFormGroup title="开卡人信息">
        <ProFormText
          name="cardholderUsername"
          label="开卡人用户名"
          rules={[{ required: true, message: '请输入开卡人用户名' }]}
          placeholder="请输入开卡人用户名"
          width="md"
        />
        <ProFormText
          name="cardholderName"
          label="开卡人姓名"
          rules={[{ required: true, message: '请输入开卡人姓名' }]}
          placeholder="请输入开卡人姓名"
          width="md"
        />
        <ProFormText
          name="cardholderEmail"
          label="开卡人邮箱"
          rules={[
            { required: true, message: '请输入开卡人邮箱' },
            { type: 'email', message: '请输入正确的邮箱格式' }
          ]}
          placeholder="请输入开卡人邮箱"
          width="md"
        />
      </ProFormGroup>
      
      <ProFormGroup title="卡片信息">
        <ProFormSelect
          name="currency"
          label="币种"
          options={[
            { label: 'USD', value: 'USD' },
            { label: 'EUR', value: 'EUR' },
            { label: 'GBP', value: 'GBP' },
          ]}
          rules={[{ required: true, message: '请选择币种' }]}
          width="sm"
        />
        <ProFormMoney
          name="initialAmount"
          label="初始金额"
          min={0}
          max={10000}
          rules={[{ required: true, message: '请输入初始金额' }]}
          width="md"
        />
        <ProFormTextArea
          name="remark"
          label="备注"
          placeholder="请输入备注信息"
          width="xl"
        />
      </ProFormGroup>
    </ProForm>
  );
};
```

## 数据类型定义

### TypeScript 接口

```typescript
// 用户接口 (新增)
interface User {
  id: number;
  username: string;
  email: string;
  name: string;
  role: 'super_admin' | 'admin' | 'user';
  roleText: string;
  status: 'active' | 'inactive' | 'suspended';
  statusText: string;
  
  // 金额信息 (新增)
  balance: number;
  creditLimit: number;
  currency: string;
  availableAmount: number; // 余额 + 信用额度
  
  // 上级用户信息
  parent?: {
    id: number;
    username: string;
    name: string;
  };
  
  // 统计信息
  cardCount: number;
  totalSpent: number;
  
  // 时间信息
  createdAt: string;
  updatedAt: string;
}

// 用户创建请求接口
interface CreateUserRequest {
  username: string;
  name: string;
  email: string;
  password: string;
  role: string;
  parentId?: number;
  status: string;
  balance: number;
  creditLimit: number;
  currency: string;
}

// 用户编辑请求接口
interface UpdateUserRequest {
  name?: string;
  email?: string;
  role?: string;
  parentId?: number;
  status?: string;
  balance?: number;
  creditLimit?: number;
  currency?: string;
}

// 用户资金记录接口
interface UserBalanceLog {
  id: number;
  type: 'deposit' | 'withdraw' | 'transfer_in' | 'transfer_out' | 'card_charge' | 'refund';
  typeText: string;
  amount: number;
  balanceBefore: number;
  balanceAfter: number;
  currency: string;
  description: string;
  remark?: string;
  
  // 操作者信息
  operatedBy: {
    id: number;
    username: string;
    name: string;
  };
  
  // 关联信息（可选）
  relatedCard?: {
    id: number;
    cardNo: string;
  };
  relatedUser?: {
    id: number;
    username: string;
    name: string;
  };
  
  createdAt: string;
}

// 资金操作请求接口
interface BalanceOperationRequest {
  userId: number;
  type: 'deposit' | 'withdraw';
  amount: number;
  remark?: string;
}

// 用户列表查询参数
interface UserListParams {
  current?: number;
  pageSize?: number;
  username?: string;
  email?: string;
  role?: string;
  status?: string;
  dateRange?: [string, string];
}

// 虚拟卡接口
interface VirtualCard {
  id: number;
  cardId: string;
  cardNo: string;
  balance: number;
  currency: string;
  status: 'active' | 'frozen' | 'released';
  statusText: string;
  expDate: string;
  
  // 开卡人信息
  cardholderName: string;
  cardholderUsername: string;
  cardholderEmail?: string;
  
  // 创建者信息
  createdBy: {
    id: number;
    username: string;
    name: string;
  };
  
  // 时间信息
  createdAt: string;
  updatedAt: string;
  
  remark?: string;
}

// 开卡请求接口
interface CreateCardRequest {
  cardholderUsername: string;
  cardholderName: string;
  cardholderEmail: string;
  currency: string;
  initialAmount: number;
  remark?: string;
}

// 卡片列表查询参数
interface CardListParams {
  current?: number;
  pageSize?: number;
  cardholderUsername?: string;
  cardNo?: string;
  status?: string;
  dateRange?: [string, string];
}
```

## 功能特性

### 1. 用户金额管理 (新增功能)
- ✅ 用户账户余额管理
- ✅ 信用额度设置
- ✅ 多币种支持 (USD, EUR, GBP)
- ✅ 可用金额计算 (余额 + 信用额度)
- ✅ 充值功能 (管理员操作)
- ✅ 提现功能 (管理员操作)
- ✅ 资金记录追踪
- ✅ 开卡自动扣费

### 2. 用户管理功能
- ✅ 用户创建时设置初始余额和信用额度
- ✅ 用户列表显示金额信息
- ✅ 按余额范围筛选用户
- ✅ 资金操作权限控制
- ✅ 用户资金记录查询

### 3. 开卡人信息管理
- ✅ 录入开卡人用户名（必填）
- ✅ 录入开卡人姓名（必填）  
- ✅ 录入开卡人邮箱（可选）
- ✅ 显示在卡片列表中

### 2. 搜索和筛选
- ✅ 按开卡人用户名搜索
- ✅ 按卡号搜索
- ✅ 按卡片状态筛选
- ✅ 按创建时间范围筛选

### 3. 列表展示
- ✅ 表格形式展示所有卡片信息
- ✅ 支持排序（余额、创建时间）
- ✅ 支持分页
- ✅ 显示创建者信息

### 4. 权限控制
- 普通用户只能看到自己创建的卡片
- 管理员可以看到下属用户创建的卡片
- 超级管理员可以看到所有卡片

### 5. 数据导出
- 支持导出Excel格式
- 包含所有开卡人信息
- 支持按筛选条件导出

## 实现优先级

### 高优先级（必须实现）
1. ✅ 用户表结构更新（添加金额字段）
2. ✅ 用户资金记录表创建
3. ✅ 用户创建/编辑表单添加金额设置
4. ✅ 用户列表显示金额信息
5. ✅ 用户充值/提现功能
6. ✅ 开卡表单添加开卡人信息字段
7. ✅ 卡片列表显示开卡人用户名
8. ✅ 按开卡人用户名搜索功能

### 中优先级（重要功能）
1. 🔄 用户资金记录查询页面
2. 🔄 开卡自动扣费逻辑
3. 🔄 资金操作权限控制
4. 🔄 多币种汇率转换
5. 🔄 卡片详情页面显示完整开卡人信息
6. 🔄 数据导出功能

### 低优先级（增强功能）
1. ⏳ 用户金额统计分析
2. ⏳ 资金预警功能
3. ⏳ 批量资金操作
4. ⏳ 开卡人信息统计分析
5. ⏳ 高级筛选功能
